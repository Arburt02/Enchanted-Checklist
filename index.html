<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<title>The Enchanted Checklist</title>

	<style>
		body {
			margin: 0;
			font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
			background: linear-gradient(180deg, #c2e9fb 0%, #a1c4fd 50%, #fbc2eb 100%);
			background-attachment: fixed;
			background-repeat: no-repeat;
			background-size: cover;
			color: white;
			padding: 2rem;
			min-height: 100vh;
		}

		body.dark {
			background: #121212;
			color: white;
		}

		.main-container {
			width: 90%;
			max-width: 600px;
			margin: 0 auto;
			padding-left: 1rem;
			padding-right: 1rem;
		}

		@media (min-width: 768px) {
			.main-container {
				width: 70%;
			}
		}

		@media (min-width: 1024px) {
			.main-container {
				width: 50%;
			}
		}

		h1 {
			font-size: 2rem;
			margin-bottom: 1rem;
			text-align: center;
		}

		input,
		button {
			margin: 0.5rem 0;
			padding: 0.6rem;
			border: none;
			border-radius: 8px;
			font-size: 1rem;
		}

		input {
			width: 100%;
			max-width: 300px;
		}

		button {
			background-color: white;
			color: #2f77a7;
			cursor: pointer;
			font-weight: bold;
			width: 100%;
			max-width: 300px;
		}

		.button-group button {
			margin-bottom: 0.5rem;
		}

		#progress-rings svg {
			width: 150px;
			height: 150px;

		}

		#progress-rings circle {
			filter: url(#glow);
			transition: stroke-dashoffset 1.5s ease-out;
		}

		@media (min-width: 768px) {
			#progress-rings svg {
				width: 200px;
				height: 200px;
			}
		}

		@keyframes pulse {
			0% {
				transform: scale(1);
				opacity: 1;
			}

			50% {
				transform: scale(1.05);
				opacity: 0.75;
			}

			100% {
				transform: scale(1);
				opacity: 1;
			}
		}

		.pulse-once {
			animation: pulse 1.2s ease-out;
		}

		.preferences-toggle {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  margin: 0.5rem 0;
  background: rgba(255, 255, 255, 0.15);
  padding: 0.75rem 1rem;
  border-radius: 8px;
}

	</style>
</head>

<body style="display: none;">
	<div class="main-container">
		<h1>
			<i class="fas fa-wand-magic-sparkles" style="margin-right: 0.5rem;"></i>
			The Enchanted Checklist
		</h1>

		<!-- üîê Auth -->
		<div id="authSection" style="display: none;">
			<input type="email" id="email" placeholder="Email" /><br />
			<input type="password" id="password" placeholder="Password" /><br />
			<button onclick="login()">Login</button>
			<button onclick="register()">Register</button>
		</div>


		<!-- üè† Landing -->
<div id="landingPage" style="display: none; text-align: center;">
  <h2>Your Ultimate Guide to Completing Disney!</h2>
  <p>
    Whether you're visiting the parks for the 1st time or the 50th, there's always something magical left to discover.
    Use this guide to track progress across all that Disney has to offer.<br>
    Tap below to begin checking off tasks. Over time we will add experiences for a more comprehensive checklist. Use the Preferences section below to customize which parts of Disney you want to include.
  </p>

  <div style="margin-top: 1rem; display: flex; flex-direction: column; gap: 1rem;">
    <button onclick="loadExperiences()">
      <i class="fas fa-map-marked-alt" style="margin-right: 0.5rem;"></i>
      Your Experiences
    </button>
    <button onclick="openPreferences()">
      <i class="fas fa-cog" style="margin-right: 0.5rem;"></i>
      Preferences
    </button>
    <button onclick="openFavorites()">
      <i class="fas fa-star" style="margin-right: 0.5rem;"></i>
      For The Next Trip
    </button>
    <small style="display:block; margin-top:-0.25rem; margin-bottom:-0.25rem; color:white; opacity:0.8;" aria-live="polite">
      (Empty for now? Tasks you save will appear here.)
    </small>
    <button onclick="logout()">
      <i class="fas fa-door-open" style="margin-right: 0.5rem;"></i>
      Logout
    </button>
  </div>
  
<div id="progress-rings" style="display:flex; justify-content:center; align-items:center; margin: 2rem 0;">
  <svg width="200" height="200" viewBox="0 0 200 200">
    <defs>
      <filter id="glow">
        <feDropShadow dx="0" dy="0" stdDeviation="3" flood-color="#000000" flood-opacity="0.25" />
      </filter>
    </defs>

    <!-- Background Rings -->
    <circle cx="100" cy="100" r="90" stroke="#deb6ee" stroke-width="10" fill="none" opacity="0.2" />
    <circle cx="100" cy="100" r="70" stroke="#dc81ff" stroke-width="10" fill="none" opacity="0.2" />
    <circle cx="100" cy="100" r="50" stroke="#c075e4" stroke-width="10" fill="none" opacity="0.2" />

    <!-- Foreground Progress Rings (with glow) -->
    <circle id="ring-total" cx="100" cy="100" r="90" stroke="#deb6ee" stroke-width="10" fill="none"
      stroke-linecap="round" transform="rotate(-90 100 100)"
      stroke-dasharray="565.5" stroke-dashoffset="565.5"
      filter="url(#glow)" />

    <circle id="ring-wdw" cx="100" cy="100" r="70" stroke="#dc81ff" stroke-width="10" fill="none"
      stroke-linecap="round" transform="rotate(-90 100 100)"
      stroke-dasharray="439.8" stroke-dashoffset="439.8"
      filter="url(#glow)" />

    <circle id="ring-dl" cx="100" cy="100" r="50" stroke="#c075e4" stroke-width="10" fill="none"
      stroke-linecap="round" transform="rotate(-90 100 100)"
      stroke-dasharray="314.2" stroke-dashoffset="314.2"
      filter="url(#glow)" />
  </svg>
</div>

    <!-- SVG Rings (unchanged) -->
  </div>

  <div style="text-align:center; margin-top: 1rem;">
    <div id="percent-total" style="font-weight:bold; font-size:1.2rem;"></div>
    <div id="percent-wdw"></div>
    <div id="percent-dl"></div>
  </div>
</div>

<!-- ‚öôÔ∏è Preferences (must be outside of landingPage) -->
<div id="preferencesPage" style="display: none; text-align: left; max-width: 400px;"></div>

<script>
  function loadExperiences() {
    window.location.href = "checklist.html";
  }

  function openFavorites() {
    window.location.href = "favorites.html";
  }

  function openPreferences() {
    hideAllSections();

    // ‚úÖ Hide progress rings and percent labels when Preferences is open
    document.getElementById("progress-rings").style.display = "none";
    document.getElementById("percent-total").style.display = "none";
    document.getElementById("percent-wdw").style.display = "none";
    document.getElementById("percent-dl").style.display = "none";

    // ‚úÖ Show preferences page
    document.getElementById("preferencesPage").style.display = "block";
    renderPreferences();
  }

			function renderPreferences() {
  const container = document.getElementById("preferencesPage");

  container.innerHTML = `
    <h2>Preferences</h2>
    <button onclick="returnToLanding()">‚Üê Back</button>

    <div class="preferences-toggle" onclick="openCustomizeChecklist()">
      <i class="fas fa-folder-open" style="margin-right: 0.5rem;"></i>
      Customize My Checklist
    </div>

  <div class="preferences-toggle">
  <input type="checkbox" id="darkModeToggle" />
  <span style="flex: 1; text-align: right;">Dark Mode</span>
</div>

    <div class="preferences-toggle" style="opacity: 0.5;">
      <span>
        <i class="fas fa-lock" style="margin-right: 0.5rem;"></i>
        Change Password (coming soon)
      </span>
    </div>
  `;

  const darkModeToggle = document.getElementById("darkModeToggle");
  darkModeToggle.checked = localStorage.getItem("dark_mode") === "true";
  darkModeToggle.onchange = () => {
    localStorage.setItem("dark_mode", darkModeToggle.checked ? "true" : "false");
    document.body.classList.toggle("dark", darkModeToggle.checked);
  };
}

			function openCustomizeChecklist() {
				const container = document.getElementById("preferencesPage");
				container.innerHTML = `
    <h2>Customize My Checklist</h2>
    <button onclick="renderPreferences()">‚Üê Back</button>
    <h3>Walt Disney World</h3>
  `;

				["Magic Kingdom", "EPCOT", "Animal Kingdom", "Hollywood Studios"].forEach(park => {
					const locked = document.createElement("div");
					locked.className = "preferences-toggle";
					locked.style.opacity = "0.5";
					locked.innerHTML = `<i class="fas fa-check-circle" style="margin-right: 0.5rem;"></i>${park} (locked)`;
					container.appendChild(locked);
				});

				[
					{ label: "Include Park Hopper Plus", park: "Park Hopper Plus" },
					{ label: "Include Disney Springs", park: "Disney Springs" },
					{ label: "Include Resorts", park: "Walt Disney World Resorts" }
				].forEach(pref => {
					const key = `include_${pref.park}`;
					const wrapper = document.createElement("div");
					wrapper.className = "preferences-toggle";
					wrapper.innerHTML = `<span>${pref.label}</span><input type="checkbox" ${localStorage.getItem(key) !== "false" ? "checked" : ""} onchange="localStorage.setItem('${key}', this.checked ? 'true' : 'false')">`;
					container.appendChild(wrapper);
				});

				container.innerHTML += `<h3>Disneyland</h3>`;

				const dlrParks = [
					"Disneyland Park",
					"Disney California Adventure",
					"Downtown Disney District",
					"Disneyland Resorts"
				];

				const masterChecked = dlrParks.every(name => localStorage.getItem(`include_${name}`) !== "false");

				const masterWrapper = document.createElement("div");
				masterWrapper.className = "preferences-toggle";
				masterWrapper.innerHTML = `<span>Include All Disneyland Areas</span><input type="checkbox" ${masterChecked ? "checked" : ""} onchange="toggleAllDLR(this)">`;
				container.appendChild(masterWrapper);

				dlrParks.forEach(park => {
					const key = `include_${park}`;
					const wrapper = document.createElement("div");
					wrapper.className = "preferences-toggle";
					wrapper.innerHTML = `<span>${park}</span><input type="checkbox" id="${key}" ${localStorage.getItem(key) !== "false" ? "checked" : ""} onchange="localStorage.setItem('${key}', this.checked ? 'true' : 'false')">`;
					container.appendChild(wrapper);
				});
			}

			function toggleAllDLR(master) {
				const parks = [
					"Disneyland Park",
					"Disney California Adventure",
					"Downtown Disney District",
					"Disneyland Resorts"
				];
				parks.forEach(park => {
					const key = `include_${park}`;
					localStorage.setItem(key, master.checked ? "true" : "false");
					const el = document.getElementById(key);
					if (el) el.checked = master.checked;
				});
			}

			function updateGlobalProgress() {
				fetch('checklist.json')
					.then(res => res.json())
					.then(data => {
						const wdwCore = ["Magic Kingdom", "EPCOT", "Animal Kingdom", "Hollywood Studios"];
						const wdwOptional = ["Park Hopper Plus", "Disney Springs", "Walt Disney World Resorts"];
						const dlrParks = ["Disneyland Park", "Disney California Adventure", "Downtown Disney District", "Disneyland Resorts"];

						const wdwFilters = {};
						wdwOptional.forEach(p => wdwFilters[p] = localStorage.getItem(`include_${p}`) !== "false");

						const dlrFilters = {};
						dlrParks.forEach(p => dlrFilters[p] = localStorage.getItem(`include_${p}`) !== "false");

						const filteredData = data.filter(task => {
							if (task.Experience === "Walt Disney World") {
								return wdwCore.includes(task.Park) || wdwFilters[task.Park];
							} else if (task.Experience === "Disneyland") {
								return dlrFilters[task.Park];
							}
							return false;
						});

						const wdw = filteredData.filter(t => t.Experience === "Walt Disney World");
						const dl = filteredData.filter(t => t.Experience === "Disneyland");

						let total = filteredData.length;
						let totalComplete = 0;
						let wdwComplete = 0;
						let dlComplete = 0;

						filteredData.forEach(task => {
							const taskId = task.id || `${task.Park}-${task.Area}-${task.Task}`;
							if (localStorage.getItem(taskId) === "complete") {
								totalComplete++;
								if (task.Experience === "Walt Disney World") wdwComplete++;
								if (task.Experience === "Disneyland") dlComplete++;
							}
						});

						const totalPercent = total > 0 ? totalComplete / total : 0;
						const wdwPercent = wdw.length > 0 ? wdwComplete / wdw.length : 0;
						const dlPercent = dl.length > 0 ? dlComplete / dl.length : 0;

						document.getElementById("ring-total").style.strokeDashoffset = 565.5 * (1 - totalPercent);
						document.getElementById("ring-wdw").style.strokeDashoffset = 439.8 * (1 - wdwPercent);
						document.getElementById("ring-dl").style.strokeDashoffset = 314.2 * (1 - dlPercent);

						document.getElementById("percent-total").innerHTML = `<i class="fas fa-bullseye" style="margin-right:0.5rem;"></i> Total: ${(totalPercent * 100).toFixed(1)}% ‚Äî ${totalComplete}/${total}`;
						document.getElementById("percent-wdw").innerHTML = `<i class="fas fa-landmark-dome" style="margin-right:0.5rem;"></i> Walt Disney World: ${(wdwPercent * 100).toFixed(1)}% ‚Äî ${wdwComplete}/${wdw.length}`;
						document.getElementById("percent-dl").innerHTML = `<i class="fas fa-bridge" style="margin-right:0.5rem;"></i> Disneyland: ${(dlPercent * 100).toFixed(1)}% ‚Äî ${dlComplete}/${dl.length}`;
					});
			}

window.returnToLanding = function () {
  hideAllSections(); // üßº Start fresh
  document.getElementById("landingPage").style.display = "block";

  // ‚úÖ Show progress rings and percentages after re-showing landingPage
  document.getElementById("progress-rings").style.display = "flex";
  document.getElementById("percent-total").style.display = "block";
  document.getElementById("percent-wdw").style.display = "block";
  document.getElementById("percent-dl").style.display = "block";

  updateGlobalProgress();

  // ‚úÖ Re-trigger pulse animation
  const rings = document.getElementById("progress-rings");
  rings.classList.remove("pulse-once");
  void rings.offsetWidth;
  rings.classList.add("pulse-once");
};

function showLandingPage() {
  hideAllSections();
  document.getElementById("landingPage").style.display = "block";
  updateGlobalProgress();

  // ‚úÖ Re-trigger pulse animation
  const rings = document.getElementById("progress-rings");
  rings.classList.remove("pulse-once");
  void rings.offsetWidth; // Force reflow
  rings.classList.add("pulse-once");
}

function hideAllSections() {
  document.getElementById("authSection").style.display = "none";
  document.getElementById("landingPage").style.display = "none";
  document.getElementById("preferencesPage").style.display = "none";
}

if (localStorage.getItem("dark_mode") === "true") {
  document.body.classList.add("dark");
}
		</script>

		<!-- üîå Firebase SDK -->
		<script type="module">
			import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
			import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

			const firebaseConfig = {
				apiKey: "AIzaSyDLDycGnK6Nm8m5KqbhhPSKz7GNb3PjZCo",
				authDomain: "the-enchanted-checklist.firebaseapp.com",
				projectId: "the-enchanted-checklist",
				storageBucket: "the-enchanted-checklist.appspot.com",
				messagingSenderId: "971177969419",
				appId: "1:971177969419:web:3a48e119cb866f6551840e"
			};

			const app = initializeApp(firebaseConfig);
			const auth = getAuth(app);

			window.login = async function() {
				const email = document.getElementById("email").value;
				const password = document.getElementById("password").value;
				try {
					await signInWithEmailAndPassword(auth, email, password);
				} catch (err) {
					alert("Login failed: " + err.message);
				}
			};

			window.register = async function() {
				const email = document.getElementById("email").value;
				const password = document.getElementById("password").value;
				try {
					await createUserWithEmailAndPassword(auth, email, password);
				} catch (err) {
					alert("Registration failed: " + err.message);
				}
			};

			onAuthStateChanged(auth, user => {
				document.body.style.display = "block";
				if (localStorage.getItem("dark_mode") === "true") {
					document.body.classList.add("dark");
				} else {
					document.body.classList.remove("dark");
				}

				if (user) {
					showLandingPage();
				} else {
					hideAllSections();
					document.getElementById("authSection").style.display = "block";
				}
			});

			window.logout = async function() {
				try {
					await signOut(auth);
					hideAllSections();
					document.getElementById("authSection").style.display = "block";
				} catch (err) {
					alert("Logout failed: " + err.message);
				}
			};
		</script>
</body>

</html>